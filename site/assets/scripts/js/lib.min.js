class KVIdb{constructor(e="kv_db",t="kv_store",o=1){this.idb_o=null,this.ready_o=null,this.idb_s=e,this.store_s=t,this.version_n=o,this.init__v()}init__v(){this.ready_o=new Promise((e,t)=>{const o=window.indexedDB.open(this.idb_s,this.version_n);o.onupgradeneeded=e=>{this.idb_o=e.target.result,this.idb_o.createObjectStore(this.store_s)},o.onsuccess=t=>{this.idb_o=t.target.result,e(t.target.result)},o.onerror=e=>t(e.target.error)})}store__o(e="readonly"){return this.idb_o.transaction([this.store_s],e).objectStore(this.store_s)}set__v(e,t){return this.ready_o.then(()=>new Promise((o,r)=>{const s=this.store__o("readwrite").put(t,e);s.onsuccess=o,s.onerror=r}))}update__v(e,t,o){return this.ready_o.then(()=>new Promise((r,s)=>{const n=this.store__o("readwrite"),i=n.get(e);i.onsuccess=()=>{const c=i.result;c[t]=o;const l=n.put(c,e);l.onsuccess=r,l.onerror=s},i.onerror=s}))}walk__v(e){return this.ready_o.then(()=>new Promise((t,o)=>{const r=this.store__o().openCursor();r.onsuccess=o=>{let r=o.target.result;r?(e(r.key,r.value),r.continue()):t()},r.onerror=o}))}get__(e){return this.ready_o.then(()=>new Promise((t,o)=>{const r=this.store__o().get(e);r.onsuccess=e=>t(e.target.result),r.onerror=o}))}key__b(e){return this.ready_o.then(()=>new Promise((t,o)=>{const r=this.store__o().count(e);r.onsuccess=e=>t(e.target.result),r.onerror=o}))}last__(){return this.ready_o.then(()=>new Promise((e,t)=>{const o=this.store__o("readwrite").openCursor(null,"prev");o.onsuccess=t=>{t.target.result&&e(t.target.result.value)},o.onerror=t}))}deleteAll__v(e){return this.ready_o.then(()=>new Promise((t,o)=>{const r=this.store__o("readwrite"),s=store.openCursor();s.onsuccess=t=>{let o,s=t.target.result;s&&(o=s.value,e(o)&&r.delete(s.key),s.continue())},s.onerror=o}))}delete__v(e){return this.ready_o.then(()=>new Promise((t,o)=>{const r=this.store__o("readwrite").delete(e);r.onsuccess=t,r.onerror=o}))}clear__v(){return this.ready_o.then(()=>new Promise((e,t)=>{const o=this.store__o("readwrite").clear();o.onsuccess=e,o.onerror=t}))}deleteIDB__v(){window.indexedDB.deleteDatabase(this.idb_s)}}const idb_o=new KVIdb("wic_idb","wic_store"),hueBase__v=e=>{idb_o.get__("hue_base").then(t=>{void 0===e&&(e=t||0),idb_o.set__v("hue_base",e),DOM_rootVar__v("--c_hue_base",e),console.log(`Base hue has been set to: ${e}`)})},lumMode__v=e=>{idb_o.get__("lum_mode").then(t=>{void 0===e&&(e=t||1),idb_o.set__v("lum_mode",e),DOM_rootVar__v("--lum_mode",e),console.log(`Luminosity mode has been set to: ${e} ${e>0?"(LIGHT)":"(DARK)"} `)})},DOM_rootVar__s=e=>window.getComputedStyle(document.documentElement).getPropertyValue(e)||"",DOM_rootVar__v=(e,t)=>document.documentElement.style.setProperty(e,t),DOM_loader__v=(e,t,o=0)=>{const r=document.querySelector(e);r.addEventListener("load",()=>{r.before((r.contentDocument.body||r.contentDocument).children[0]),r.remove(),t&&(o?window.setTimeout(t,o):t())})},DOM_siblings__a=e=>{const t=document.querySelector(e);return t?Array.prototype.filter.call(t.parentNode.children,e=>e!==t):null},DOM_listReverse__v=e=>{Array.prototype.slice.call(document.querySelectorAll(`${e} li`)).forEach(e=>e.parentNode.insertBefore(e,e.parentNode.firstChild))},DOM_scroll__v=e=>{const t={top:e?document.querySelector("body").offsetHeight:0,left:0,behavior:"smooth"};window.scroll(t)},DOM_locationKey__s=()=>{const e=".html".length;let t=window.location.href;return t.slice(t.lastIndexOf("nouvelless/"),-e)},service__v=e=>{navigator.serviceWorker.register(e).then(e=>console.log(`ServiceWorker registration successful [scope: ${e.scope}]`),e=>console.log(`ServiceWorker registration failed [error: ${e}]`))},shortNote__v=e=>{const t=e.target.closest("INS");t&&(shortImg__v(t),t.querySelector('[data--="note_content"]').classList.toggle("note_open"))},shortImg__v=e=>{const t=e.querySelector('[data-src^="http"]');if(!t)return;const o=t.getAttribute("data-size");if(o){const[e,r]=o.split(" ");if(!e)return;let s=`width:${e}${`${parseInt(e)}`.length===e.length?"px":""};`;if(r){s+=` height:${r}${`${parseInt(r)}`.length===r.length?"px":""};`}if(s){let e=t.getAttribute("style");t.setAttribute("style",`${e||""} ${s}`)}}t.decoding="async",t.src=t.getAttribute("data-src"),t.setAttribute("data-src","")},loadColorImg__v=(e,t="gray",o="color")=>{const r=e.closest(".note_open"),s=r.querySelector("img"),n=s.getAttribute("src");n.includes(t)&&(s.src=n.replace(t,o),r.classList.toggle("note_open"))},menuPosition__v=()=>{const e=document.querySelector('[data--="menu"]');let t=document.querySelector('[data--="header"]').offsetHeight;t+=document.querySelector('[data--="link_page"]').offsetHeight,e.style.transform=`translateY( ${t}px)`;const o=e.offsetHeight,r=document.querySelector('[data--="article"]'),s=r.offsetHeight;o<s?e.style.height=`${s}px`:r.style.height=`${o}px`},menu__v=()=>{const e="1"===(t="--MENU_SHOW",window.getComputedStyle(document.documentElement).getPropertyValue(t)||"")?"0":"1";var t;DOM_rootVar__v("--MENU_SHOW",e),comments_e=document.querySelector(".utterances"),null!==comments_e&&comments_e.classList.toggle("retract");const o=document.querySelector('[data--="menu"]');"1"===e?(o.classList.remove("no_pointer"),DOM_scroll__v()):o.classList.add("no_pointer")},comments__v=()=>{const e=document.querySelector('[data--="comments"]');if(!e.hasChildNodes()){const t=document.createElement("script");t.setAttribute("data--","comments_script"),t.setAttribute("src","https://utteranc.es/client.js"),t.setAttribute("repo","octoxalis/wic"),t.setAttribute("issue-term","t"),t.setAttribute("theme","photon-dark"),t.setAttribute("crossorigin","anonymous"),t.setAttribute("async",!0),e.appendChild(t)}e.classList.toggle("retract")},linkNear__o=e=>{const t=document.querySelector('[data--="menu_list"]'),o=".html".length,r=window.location.pathname.slice(1,-o),s=document.querySelectorAll('[data--="menu_list"] > li');if(!s)return;const n=s.length,i=+t.querySelector(`[data-link="${r}"]`).getAttribute("data-rank"),c="link_previous"===e?i-1:i+1;if(c<1||c>n)return;const l=t.querySelector(`[data-rank="${c}"]`);if(!l)return;const a=l.querySelector("span > a");if(!a)return;const _=l.querySelector('span[data--="note_content"]');return a?{link_s:l.getAttribute("data-link"),title_s:a.innerHTML,abstract_s:_.innerHTML}:void 0},linkNear__v=(e,t)=>{if(null!==t){if("mouseenter"===e){const e=t.getAttribute("data--");let o,r;const s=linkNear__o(e);void 0!==s?(o=`<a href="https://wic.netlify.com/${s.link_s}.html">${s.title_s}</a>`,r=`<i>${s.abstract_s}</i>`):(o="Plus d'autres nouvelles",r=""),document.querySelector('[data--="link_title"]').innerHTML=o,document.querySelector('[data--="link_abstract"]').innerHTML=r}document.querySelector('[data--="link_info"]').classList.toggle("retract")}},linkURL__s=e=>{const t=linkNear__o(e);return t?`https://wic.netlify.com/${t.link_s}.html`:void 0};!function(){var e;DOM_loader__v('[data--="menu_iframe"]',()=>{window.addEventListener("load",()=>{document.querySelector('[data--="menu_list"]').addEventListener("click",shortNote__v)}),document.querySelector('[data--="menu_order"]').addEventListener("click",e=>{var t;e.target.closest("menu")&&(t='[data--="menu_list"]',Array.prototype.slice.call(document.querySelectorAll(`${t} li`)).forEach(e=>e.parentNode.insertBefore(e,e.parentNode.firstChild)))}),menuPosition__v()}),"serviceWorker"in navigator&&window.addEventListener("load",(e="https://wic.netlify.com/assets/scripts/js/service_worker.min.js",void navigator.serviceWorker.register(e).then(e=>console.log(`ServiceWorker registration successful [scope: ${e.scope}]`),e=>console.log(`ServiceWorker registration failed [error: ${e}]`))));const t=document.querySelector('[data--="link_nav"]');null!=t&&(t.addEventListener("click",e=>{const t=e.target.closest("BUTTON");if(null===t)return;let o=t.getAttribute("data--");switch(o){case"link_menu":return void menu__v();case"link_top":case"link_bottom":return void DOM_scroll__v("link_bottom"===o);case"link_previous":case"link_next":{const e=linkURL__s(o);e&&(window.location=e)}}}),document.querySelectorAll('[data--="link_nav"] > button').forEach(e=>{switch(e.getAttribute("data--")){case"link_top":case"link_bottom":case"link_menu":return}["mouseenter","mouseleave"].forEach(t=>e.addEventListener(t,e=>linkNear__v(t,e.currentTarget)))})),document.querySelector('[data--="article"]').addEventListener("click",shortNote__v);const o=document.querySelector('[data--="comments_visibility"]');o&&o.addEventListener("click",e=>comments__v()),hueBase__v(),lumMode__v();const r=document.querySelector('[data--="header"]');r.addEventListener("click",e=>{{const t=e.clientX-r.getBoundingClientRect().left,o=r.offsetWidth;hueBase__v(~~(t/o*360))}const t=e.clientY-r.getBoundingClientRect().top,o=r.offsetHeight;lumMode__v(t>.5*o?-1:1)})}();
